<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.290">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Where is your money, and why? – methods</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<link href="./../img/favicon.ico" rel="icon">
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Where is your money, and why?</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html" rel="" target="">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="./methods.html" rel="" target="" aria-current="page">
 <span class="menu-text">Methods</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./data.html" rel="" target="">
 <span class="menu-text">Data</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./authors.html" rel="" target="">
 <span class="menu-text">Authors</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools ms-auto">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#methods" id="toc-methods" class="nav-link active" data-scroll-target="#methods">Methods</a>
  <ul class="collapse">
  <li><a href="#figure-x-grid-bubble-map-of-the-progression-of-bank-assets-per-decade" id="toc-figure-x-grid-bubble-map-of-the-progression-of-bank-assets-per-decade" class="nav-link" data-scroll-target="#figure-x-grid-bubble-map-of-the-progression-of-bank-assets-per-decade">Figure X: Grid bubble map of the progression of bank assets per decade</a></li>
  <li><a href="#figure-x-dot-map-with-heatmap-of-bank-assets-as-of-q4-2022" id="toc-figure-x-dot-map-with-heatmap-of-bank-assets-as-of-q4-2022" class="nav-link" data-scroll-target="#figure-x-dot-map-with-heatmap-of-bank-assets-as-of-q4-2022">Figure X: Dot map with heatmap of bank assets as of Q4 2022</a></li>
  <li><a href="#figure-x-temporal-trend-of-the-total-domestic-deposits-in-the-us-for-the-past-3-decades" id="toc-figure-x-temporal-trend-of-the-total-domestic-deposits-in-the-us-for-the-past-3-decades" class="nav-link" data-scroll-target="#figure-x-temporal-trend-of-the-total-domestic-deposits-in-the-us-for-the-past-3-decades">Figure X: temporal trend of the total domestic deposits in the US for the past 3 decades</a></li>
  <li><a href="#figure-x-disparity-of-the-top-4-banks" id="toc-figure-x-disparity-of-the-top-4-banks" class="nav-link" data-scroll-target="#figure-x-disparity-of-the-top-4-banks">Figure X: Disparity of the top 4 banks</a></li>
  <li><a href="#figure-x-the-distribution-of-commercial-banks-in-the-us-by-the-assets-in-possession" id="toc-figure-x-the-distribution-of-commercial-banks-in-the-us-by-the-assets-in-possession" class="nav-link" data-scroll-target="#figure-x-the-distribution-of-commercial-banks-in-the-us-by-the-assets-in-possession">Figure X: The distribution of commercial banks in the US by the assets in possession</a></li>
  <li><a href="#figure-x-breakdown-of-top-5-banks-the-next-125-banks-and-all-other-banks" id="toc-figure-x-breakdown-of-top-5-banks-the-next-125-banks-and-all-other-banks" class="nav-link" data-scroll-target="#figure-x-breakdown-of-top-5-banks-the-next-125-banks-and-all-other-banks">Figure X: Breakdown of top 5 banks, the next 125 banks, and all other banks</a></li>
  <li><a href="#figure-x-state-bank-deposits-by-bank" id="toc-figure-x-state-bank-deposits-by-bank" class="nav-link" data-scroll-target="#figure-x-state-bank-deposits-by-bank">Figure X: State bank deposits by bank</a></li>
  <li><a href="#figure-x-eqr" id="toc-figure-x-eqr" class="nav-link" data-scroll-target="#figure-x-eqr">Figure X: EQR</a></li>
  <li><a href="#figure-x-top-and-bottom-20-histogram" id="toc-figure-x-top-and-bottom-20-histogram" class="nav-link" data-scroll-target="#figure-x-top-and-bottom-20-histogram">Figure X: Top and Bottom 20 Histogram</a></li>
  <li><a href="#figure-x-quarters-line-graph" id="toc-figure-x-quarters-line-graph" class="nav-link" data-scroll-target="#figure-x-quarters-line-graph">Figure X: Quarters Line Graph</a></li>
  <li><a href="#figure-x-eqr-and-assets-small-counts" id="toc-figure-x-eqr-and-assets-small-counts" class="nav-link" data-scroll-target="#figure-x-eqr-and-assets-small-counts">Figure X: EQR and Assets: Small Counts</a></li>
  <li><a href="#figure-x-bubble-plot" id="toc-figure-x-bubble-plot" class="nav-link" data-scroll-target="#figure-x-bubble-plot">Figure X: Bubble Plot</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">



<section id="methods" class="level1 unnumbered">
<h1 class="unnumbered">Methods</h1>
<p>This section describes the process, considerations, and tools that went into developing each visualization in the Home tab. All the code for this project is available on <a href="https://github.com/anly503/spring2023-project-team-4/tree/main/code">GitHub</a>.</p>
<section id="figure-x-grid-bubble-map-of-the-progression-of-bank-assets-per-decade" class="level3">
<h3 class="anchored" data-anchor-id="figure-x-grid-bubble-map-of-the-progression-of-bank-assets-per-decade">Figure X: Grid bubble map of the progression of bank assets per decade</h3>
</section>
<section id="figure-x-dot-map-with-heatmap-of-bank-assets-as-of-q4-2022" class="level3">
<h3 class="anchored" data-anchor-id="figure-x-dot-map-with-heatmap-of-bank-assets-as-of-q4-2022">Figure X: Dot map with heatmap of bank assets as of Q4 2022</h3>
</section>
<section id="figure-x-temporal-trend-of-the-total-domestic-deposits-in-the-us-for-the-past-3-decades" class="level3">
<h3 class="anchored" data-anchor-id="figure-x-temporal-trend-of-the-total-domestic-deposits-in-the-us-for-the-past-3-decades">Figure X: temporal trend of the total domestic deposits in the US for the past 3 decades</h3>
</section>
<section id="figure-x-disparity-of-the-top-4-banks" class="level3">
<h3 class="anchored" data-anchor-id="figure-x-disparity-of-the-top-4-banks">Figure X: Disparity of the top 4 banks</h3>
</section>
<section id="figure-x-the-distribution-of-commercial-banks-in-the-us-by-the-assets-in-possession" class="level3">
<h3 class="anchored" data-anchor-id="figure-x-the-distribution-of-commercial-banks-in-the-us-by-the-assets-in-possession">Figure X: The distribution of commercial banks in the US by the assets in possession</h3>
</section>
<section id="figure-x-breakdown-of-top-5-banks-the-next-125-banks-and-all-other-banks" class="level3">
<h3 class="anchored" data-anchor-id="figure-x-breakdown-of-top-5-banks-the-next-125-banks-and-all-other-banks">Figure X: Breakdown of top 5 banks, the next 125 banks, and all other banks</h3>
</section>
<section id="figure-x-state-bank-deposits-by-bank" class="level3">
<h3 class="anchored" data-anchor-id="figure-x-state-bank-deposits-by-bank">Figure X: State bank deposits by bank</h3>
<p>The data for this plot comes from the quarterly bank financial data collected using the FDIC API. Then, in the Data Cleaning tab, we grouped the data by state, by bank, and by date meaning our data now showed the total assets, deposits, etc. that each bank in a given state held in a given quarter. This helped to shrink what was previously a massive dataset. However, that was still quite large. Therefore, that data file (../data/quarterly_banks_by_state/quarterly_banks_by_state.csv) is not in our github, however, you can see the code to create this file under ./code/data_cleaning/quarterly_data_cleaning.ipynb. Running this notebook will allow you to see exactly what data we are using.</p>
<p>This plot went through a lot of variations. It began by included every state’s total assets in five year windows with a slider to let the user move through the data. We then realize that five years was no where near enough time to see meaningful change so we expanded it to a decade long window. From there we realized that it would be better to just show all of the time at once, so the slider was scrapped. After doing some digging with the geo-spacial data, we found some interesting trends with the amount of money deposited in states you would not expect, such as South Dakota. In particular, we found that the biggest banks had tons of assets here. Quickly we realized this was worth exploring further so I split the data up by banks. However, it remained difficult to see how different the amounts of money was between states as you had to flip back and forth using the button. Finally, we switched to this subplot view which displays all of the states at once. The left column features the top three states by GDP while the right column features the three states we felt were most surprising in containing a ton of deposits despite being smaller states. They are all sorted vertically by GDP.</p>
<p>Before the final submission, we will look to make some of the data selection more clearly with column titles. Additionally, we may look to add some annotations that point out some important dates. For example, Wells Fargo moving from California to South Dakota in 2003. We may also consider adding an additional line to each state displaying their full deposit totals to highlight the rapid drops of increases of gaining or losing a big bank.</p>
</section>
<section id="figure-x-eqr" class="level3">
<h3 class="anchored" data-anchor-id="figure-x-eqr">Figure X: EQR</h3>
<p>For this portion of the analysis, I chose to examine banks that represent the top and bottom 20 in average EQR by quarter. For this analysis, I filtered out any banks that do not appear in the data for more than 100 quarters (roughly 80% of the quarters). This is to eliminate any potential outliers in the data. The mean value does not all observations in the data; it only includes all banks with more than 100 quarters of data since Q1 1992. Looking at the histogram, we notice that the average EQR of 11.22 is far closer to the 20 banks that have the lowest equity capital ratio compared to the 20 banks that have the highest equity capital ratio. Looking at the 5 number summary, we see that the average (11.22) is lower than the median (10.27), indicating that there are a few banks with a far higher equity capital ratio than the majority of the rest of the banks in the FDIC database. When we more closely examine the banks that fall in the range of top or bottom 20, we see that there is no consistent state across these banks. It is noteworthy that Michigan has 2 of the 3 highest banks in terms of EQR. Another noteworthy observation is that banks in Ohio, South Dakota, and North Carolina only make up 3 of the top 20 banks in average equity capital ratio. Moreover, none of the largest banks in terms of total assets are present on this list.</p>
</section>
<section id="figure-x-top-and-bottom-20-histogram" class="level3">
<h3 class="anchored" data-anchor-id="figure-x-top-and-bottom-20-histogram">Figure X: Top and Bottom 20 Histogram</h3>
</section>
<section id="figure-x-quarters-line-graph" class="level3">
<h3 class="anchored" data-anchor-id="figure-x-quarters-line-graph">Figure X: Quarters Line Graph</h3>
</section>
<section id="figure-x-eqr-and-assets-small-counts" class="level3">
<h3 class="anchored" data-anchor-id="figure-x-eqr-and-assets-small-counts">Figure X: EQR and Assets: Small Counts</h3>
</section>
<section id="figure-x-bubble-plot" class="level3">
<h3 class="anchored" data-anchor-id="figure-x-bubble-plot">Figure X: Bubble Plot</h3>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">A project by <a href="./authors.html">Group 4</a> <br></div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">Made with <a href="https://quarto.org/">Quarto</a><br> <a href="https://github.com/anly503/spring2023-project-team-4">View the source at GitHub</a></div>
  </div>
</footer>



</body></html>